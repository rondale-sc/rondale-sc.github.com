<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <title>Introducing Pivot.js</title>

  <!-- Twitter Bootstrap -->
  <link rel="stylesheet" href="/css/bootstrap.min.css" type="text/css" />

  <!-- My Custom CSS -->
  <link rel="stylesheet" href="/css/custom.css" type="text/css" />

  <link href="/images/favicon.ico" rel="shortcut icon" type="image/vnd.microsoft.icon">

  <script type="text/javascript" src="http://platform.twitter.com/widgets.js"></script>

  <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-25565068-1']);
  _gaq.push(['_setDomainName', 'jonathan-jackson.net']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</head>

<body>
  <div class="wrapper">
    <div id="header">
      <h1>run<span class="kern">_</span>with_it <span style="font-size:12px;">Learning, sharing, coding.</span></h1>
      <div class="row">
        <div class="nav-offset site-nav"><a href="/" alt="home">Home</a></div>
        <div class="site-nav"><a href="/about-me.html" alt="about-me">About Me</a></div>
        <div class="site-nav"><a href="/mail.html" alt="contact-me">Email Me</a></div>
      </div>
    </div>
    <div id="header-border"></div>

    <div class="container">
      <div id="content">
       <div id="post">
<h1>Introducing Pivot.js</h1>

<p><span><a href="http://twitter.com/share" class="twitter-share-button"
                                         data-count="horizontal"
                                         data-via="rondale_sc">Tweet</a>
</span></p>

<p>Some of you are likely aware of the library I've been working on with <a href="https://twitter.com/#!/rwjblue">@rwjblue</a> over the past few weeks.  The name of this library, as I'm sure you've (very cleverly) deduced is <em>Pivot.js</em>.  It allows you to create meaningful reports from large data sets quickly and (relatively) painlessly.  We've even created a nice little jQuery plugin that enables you to get running with very little effort. Let's go through why we built Pivot.js, and then get a pivot implemented.</p>

<h2>Why we built Pivot.js</h2>

<p>In short, summarizing data can be a serious pain.  If you've ever attempted to get something usable from 30k rows of data before, you know just how difficult this can be.  For several years we've relied on MS Excel's pivot table functionality to create enterprise-wide analysis reports.  The learning curve behind setting up an Excel pivot table leaves something to be desired, and we found ourselves unable to share our reports with our clients without setting up a VPN (unless it was a snapshot/non-interactive). We finally realized how much time we spent maintaining this structure and decided it was worth it to invest in an alternative.  Enter Pivot.js.</p>

<h2>Meet Phil</h2>

<p>Let's talk about Phil the web-savvy entrepreneur.  He has a site where he sells his homemade novelty sci-fi T-shirts.  His T-shirts have picked up sales over the past three months, breaking over a thousand sales per month.   He realizes that he'd like to create some custom reports to display his recent success and help him measure his performance.  He stumbles upon <em>Pivot.js</em> and starts creating a little Sinatra app that'll help him display some reports.</p>

<p>After reading up a little bit and requiring pivot.js in his <code>&lt;head&gt;&lt;/head&gt;</code>, he creates a new pivot based off his CSV.</p>

<p><script src='https://gist.github.com/2347874.js?file=gist-1.js'></script><noscript></p>

<pre lang="sh"><code>csv = &quot;last_name,first_name,email,date_ordered,date_delivered,sale_price,unit_identifier\n
       doo, scooby, scoobydoo12512@gmail.com,2012-02-12,2012-02-17,9.99,big-bang-rpsls\n
       flinstone,fred,freddyf12516@gmail.com,2012-02-12,2012-02-17,9.99,dr-who-bad-wolf\n
       spiegel,spike,bebop1256@gmail.com,2012-02-12,2012-02-17,9.99,tng-engage\n&quot; //etc

fields =[{name: 'last_name',      type: 'string',   filterable: true},
         {name: 'first_name',     type: 'string',   filterable: true},
         {name: 'email',          type: 'string',   filterable: true},
         {name: 'date_ordered',   type: 'date',     filterable: true},
         {name: 'date_delivered', type: 'date',     labelable: false},
         {name: 'sale_price',     type: 'float',    filterable: true},
         {name: 'unit_identifier',type: 'string',   filterable: true, summarizable: 'count' }]

pivot.init({csv: csv, fields: fields});

</code></pre>

<p></noscript></p>

<p>He starts to play around with the pivot object in the console to see what it can do for him.</p>

<p><script src='https://gist.github.com/2347874.js?file=gist-2.js'></script><noscript></p>

<pre lang="sh"><code>pivot.data().all
//=&gt; [Object, Object, Object, etc]

pivot.filters().all()
//=&gt; Object
//  &gt; __proto__: Object // No filters

</code></pre>

<p></noscript></p>

<p>Realizing that he'll need to filter the data so that he doesn't get thousands of rows returned on all his reports, he delves a bit further into the documentation and finds some filter methods.</p>

<p><script src='https://gist.github.com/2347874.js?file=gist-3.js'></script><noscript></p>

<pre lang="sh"><code>pivot.filters().apply({last_name: 'flinstone', first_name: 'fred'});
//=&gt; [Object]

</code></pre>

<p></noscript></p>

<p>&quot;Sweet!,&quot; exclaims Phil, realizing how easy that was.  He continues reading and sees that he can create custom fields to do all sorts of stuff, like determine the lag between order date and delivery date.</p>

<p><script src='https://gist.github.com/2347874.js?file=gist-4.js'></script><noscript></p>

<pre lang="sh"><code>pivot.fields().add({name: 'delivery_lag', 
                type: 'integer', 
            psuedo: true,
            labelable: false,
            summarizable: 'avg',
                psuedoFunction: function(row) { // Called on each row for display.
              return Math.abs(row.date_delivered - row.date_ordered)/1000/60/60/24;
            });

</code></pre>

<p></noscript></p>

<p>Now, he can render a report that would let him see average delivery_lag by t-shirt identifier.</p>

<p><script src='https://gist.github.com/2347874.js?file=gist-5.js'></script><noscript></p>

<pre lang="sh"><code>pivot.display().rowLabels().set(['unit_identifier'])
pivot.display().summaries().set(['deliver_lag'])
pivot.data().all()
//=&gt; Object // will contain the report

</code></pre>

<p></noscript></p>

<p>&quot;This is great, but how can I get this to a page?,&quot; Phil thinks.  He continues reading the README and gets to a section about jQuery integration.</p>

<h2>Phil gets to know jQuery_pivot</h2>

<p>After going through the entire jQuery section, he begins implementing his pivot report into his Sinatra application.  He's already built a route for /delivery-lag-report.html and has a template going.  So after including <code>jquery.js</code> and <code>pivot.js</code> and <code>jquery_pivot.js</code> into the <code>&lt;head&gt;</code> of the layout, he dives right in and builds his pivot.</p>

<p>First, he adds a div for results that looks like <code>&lt;div id=&quot;results&quot;&gt;&lt;/div&gt;</code> and a div for his menus <code>&lt;div id=&quot;pivot-menu-container&quot;&gt;&lt;/div&gt;</code>.  Then, he calls jquery_pivot on his container by adding the following snippet to his index page:</p>

<p><script src='https://gist.github.com/2347874.js?file=gist-6.js'></script><noscript></p>

<pre lang="sh"><code>$(document).ready(function() {
  csv = &quot;&quot; // same as above
  fields = [] //same as above

  $('#pivot-menu-container').pivot_display('setup', {csv:csv,fields:fields})
})

</code></pre>

<p></noscript></p>

<p>When he loads the page, Phil is greeted with three drop-downs listing his filters, labels, and summaries.  After playing with the new drop-downs, he's ready to move on.  Phil wants a report to show delivery lag by T-shirt, but he doesn't want to have to click the filters, labels, and summaries every time he refreshes the page.  A little further digging into the jQuery pivot section, he sees that he can create prefabricated reports by selecting the fields/filters he wants displayed and using the pivot.config() method to easily retrieve a valid init object.</p>

<p><script src='https://gist.github.com/2347874.js?file=gist-7.js'></script><noscript></p>

<pre lang="sh"><code>// after the page has loaded and Phil has selected delivery-lag as his summary field and row label of unit_identifer

// in the console

JSON.stringify(pivot.config())
// Phil copies the output and pastes it into his setup command

$('#pivot-menu-container').pivot_display('setup',&quot;OUTPUT FROM PIVOT.CONFIG()&quot;)

</code></pre>

<p></noscript></p>

<p>When he refreshes the page, Phil's report is already pre-set and the data is just the way he wanted it.  Hooray!</p>

<h2>Additional jQuery_pivot Options</h2>

<p>jQuery pivot allows you to specify your own containers by including <code>skipBuildContainers: true</code> to the options object passed to 'setup'.  If you do this, you need to specify divs with ids: <code>filter-list</code>, <code>label-fields</code>, and <code>summary-fields</code>.  This allows you to more easily control how your layout behaves with jQuery_pivot.</p>

<p>Also, CSV may be passed in from a URL like so:</p>

<p><script src='https://gist.github.com/2347874.js?file=gist-8.js'></script><noscript></p>

<pre lang="sh"><code>$('#pivot-menu-container').pivot_display('setup', {csv_url:'/url/to/csv',fields:fields})

</code></pre>

<p></noscript></p>

<h2>Wrapping up</h2>

<p>There you have it: Pivot and jQuery_pivot should help you more easily create reports.  It has a long way to go, but I'm very excited about its direction.  We have plans to create a Rails engine for <em>Pivot.js</em>, which will greatly help with creating pivot reports in Rails applications.  Pivot.js has a decent <a href="https://github.com/rjackson/pivot.js/blob/master/README.md">README</a>, and more extensive <a href="http://rjackson.github.com/pivot.js/docs/index.html#!/api/Pivot">documentation</a> is already underway with JsDuck.  Be sure to check out the <a href="http://rjackson.github.com/pivot.js/">example</a> page and maybe give Pivot.js some love.  Thanks for reading ^_^.</p>

<span><a href="http://twitter.com/share" class="twitter-share-button"
                                         data-count="horizontal"
                                         data-via="rondale_sc">Tweet</a>
</span> <span class="has_js"><g:plusone size="medium"></g:plusone></span>
<!-- Place this render call where appropriate -->
<script type="text/javascript">
  (function() {
    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    po.src = 'https://apis.google.com/js/plusone.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  })();
</script>


<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'run-with-it';
    var disqus_identifier = '/2012/04/10/introducing-pivotjs';
    var disqus_url = 'http://www.jonathan-jackson.net/2012/04/10/introducing-pivotjs';
    var disqus_developer = 1;

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>

</div>
      </div>

      <div id="side-bar">
       <div><a href="http://feeds.feedburner.com/jonathan-jackson/WZqA" title="Subscribe to my feed" rel="alternate" type="application/rss+xml"><img src="/images/feeds.png" alt="" style="border:0;width:100px;height:100px;"/></a></div>
<div><a href="https://twitter.com/rondale_sc" class="twitter-follow-button" alt="follow me on twitter" data-width="150px" data-show-count="false">Follow @rondale_sc</a></div>
<div><img src="/images/gravatar.png" width="167px;" height="167px;"/></div>
<div>
  <h3>Hi, I'm Jon.</h3>
  <p>I love learning new things.  Here is where I'll share what I learn.  Typically code, sometimes my experience, sometimes just a neat trick.</p>
</div>
<div>
  <h3>Projects</h3>
  <ul>
    <li><a href="http://rondale-sc.github.com/EspnRb/" alt="espn_rb, a lightweight ruby wrapper around the ESPN api." title="EspnRb">EspnRb</a></li>
    <li><a href="https://github.com/rondale-sc/image_viewer" alt="ImageViewer image browser w/controls" title="Image Viewer">ImageViewer</a></li>
    <li><a href="https://github.com/rjackson/pivot.js" alt="Pivot.js - reporting lib" title="Pivot.js">Pivot.js</a></li>
    <li><a href="https://github.com/rondale-sc/run_with_it_redux" alt="This blog's Github Repo" title="Run With It Repo">Run With It</a></li>
  </ul>
</div>
      </div>
    </div>
    <div class="push"></div>
  </div>
  <div class="footer">
    <p>Site designed by Jonathan Jackson.  With help from <a href="http://twitter.github.com/bootstrap/" alt="twitter bootstrap">@twbootstrap</a>, <a href="https://github.com/mojombo/jekyll" alt="jekyll">Jekyll</a>, and <a href="https://github.com/" alt="github">github</a></p>
  </div>
</body>
</html>